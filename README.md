# 布鲁斯网关——基于 API 接口开放平台的自研微服务网关
## 为什么要开发这个项目？
之前和同学有过一个关于 API 接口开放平台的项目的开发，其中涉及到了 API 签名认证的功能，这里简单介绍一下其实现的步骤：
1. 生成密钥对：给每个用户生成唯一的密钥对（accessKey 和 secretKey），并保存到数据库中，仅用户本人可查看自己的密钥对。
2. 请求方生成签名： 请求方（客户端）使用 secretKey 对请求参数和数据进行签名，签名的内容包括请求参数、时间戳、随机数等，签名加密算法此处选择 MD5。
3. 请求方发送请求：请求方将请求参数、签名、用户标识一起发送给 API 提供者，通常会把签名等元信息放到请求头参数中传递，注意千万不要传递 secretKey。
4. API 提供者验证签名：在 API 网关中，通过请求头获取到用户标识，根据标识到数据库中查找该用户对应的 accessKey 和 secretKey，并使用相同的签名算法生成签名，和请求中的签名进行比对，如果签名一致，则 API 提供者可以信任请求方，可以进行后续操作。
   
然后这里使用 SpringCloud GateWay 作为网关，然后在网关处进行统一鉴权认证，基于这种成熟的框架开发的好处在于其支持快速整合和部署，并且由于其经过了⻓时间的市场检验，稳定性也有⼀定的保证。

但是使用了这个虽然方便，可以实现快速开发的效果，但是当你遇到问题的时候，你就只能花时间从头去了解和排查问题，这在一定程度上增加了项目的开发成本，其就像一个透明的盒子，可以帮你快速解决一些麻烦，但是如果遇到问题了，你就需要自己去打开这个盒子，去了解一些之前没有了解过的细节。

并且，其过于成熟稳定可能也就意味着其在设计的时候可能考虑了很多的东西，即可能把一些当前项目不需要的功能整合进了系统中，导致系统功能可能过于冗余，那么这个时候，在自己的需求上去一开一个适应自己需求的网关就非常重要了。



## 市场调研
1. **Spring Cloud Gateway**

-   优点：基于 Spring 框架，拥有庞大的 Spring 生态系统，可以轻松集成其他组件。支持多种协议，如WebSocket和HTTP/2。

-   缺点：相对于其他选择，性能较慢。没有像Kong那样的灵活性，其生态和社区支持较弱。

-   设计侧重点：集成多种协议和插件，扩展性。
2. **Kong**

-   优点：基于 Nginx  和 OpenResty，提供丰富的插件，管理界面较为友好。

-   缺点：⾼性能场景可能需优 化配置，插件⽣态不如 Apache/Nginx。

-   设计侧重点：扩展性和插件生态系统。
3. **Nginx**

-   优点：高性能，配置灵活，轻量级，高稳定性。

-   缺点：模块化程度较低，扩展性差，异步处理能力受限。

-   设计侧重点：⾼性能HTTP服务器和 反向代理。
   
4. **Apache HTTP Server**
-   优点：模块丰富，社区活 跃，跨平台，⽂档⻬全 。

-   缺点：性能较差，配置复杂，更重量级。

-   设计侧重点： 多功能 Web 服务器，重视模块化。
5. **HAProxy**

- 优点：高性能，支持 TCP 和 HTTP 代理，稳定且成熟。

-   缺点：配置不如 Nginx 直观，缺乏现代 Web 界面。

-   设计侧重点：专注于高并发连接的负载均衡。
6. **Traefik**

-   优点：针对容器和云环境设计，支持多种协议和场景，易于配置和部署。可以自动发现新的服务，支持自动SSL证书管理，具有良好的扩展性。

-   缺点：社区较新，历史较短，在某些高级用例下，性能可能不如其他网关。

-   设计侧重点：云原生环境中的动态配置。
   
所以，在调查了一些比较成熟且知名度比较高的网关之后，我整理出了设计一个网关的侧重点：
1. **性能与可伸缩性**
- 关注高吞吐量和低延迟处理，以便于能够处理大量并发连接和数据流。
- 设计可在多个服务器、数据中⼼或地理区域之间伸缩的解决⽅案。
2. **安全性**
- 实现⾼级安全特性，如SSL/TLS终⽌、OAuth、JWT、API密钥验证和防⽌DDoS攻击等。
- 确保所有网关的流量都符合最新的安全标准和法规要求。
3. **可观测性**
- 提供详细的监控和日志记录功能，使得运维团队可以观测和诊断问题。
- 集成现有监控⼯具和警报系统的能⼒。
4. **路由能力**
- 开发动态路由和负载均衡策略，以⽀持微服务架构中服务发现的需求。
- ⽀持基于URL、路径或头部的路由决策。
5. **扩展性**
- 构建插件架构，使新功能能够以模块化的⽅式添加。
- 保持核⼼轻量级，允许通过插件或服务集成额外功能。
6. **多协议支持**
- 考虑⽀持多种⽹络协议，不仅限于HTTP/HTTPS，也包括WebSocket、RPC等。
7.**高可用性**
- 确保⽹关设计能够容忍单点故障和⽹络分区，提供故障转移和灾难恢复机制。
在列举出以上要解决的这些点以后，我们现在可以开始进行分析，即逐步解决以上这些问题：


## 项目架构图
![image](https://github.com/DIDA-lJ/BlossomGateWay/assets/97254796/d9cb1e54-1ee0-4c24-b333-acd27e1f69b0)


## 网关处理流程

![image](https://github.com/DIDA-lJ/BlossomGateWay/assets/97254796/5274487c-760a-4525-8ddc-e10bfb276222)

## 开发文档
项目具体细节可以查看开发文档（语雀中查看）
<a href="https://www.yuque.com/zeovo-10k9s/lqwlrb/qyhycrlgwgvtag2a?singleDoc# 《BlossmGateWay 网关技术文档》">
项目开发文档
</a>



